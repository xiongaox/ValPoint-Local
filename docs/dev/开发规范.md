# å¼€å‘è§„èŒƒ

æœ¬é¡¹ç›®éµå¾ªä¸¥æ ¼çš„å¼€å‘è§„èŒƒï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚

## æ ¸å¿ƒåŸåˆ™

### 1. MPA å¤šåº”ç”¨æ¶æ„

é¡¹ç›®é‡‡ç”¨ MPAï¼ˆå¤šé¡µåº”ç”¨ï¼‰æ¶æ„ï¼ŒåŒ…å«ä¸‰ä¸ªç‹¬ç«‹åº”ç”¨ï¼š

```
src/apps/
â”œâ”€â”€ shared/     # å…±äº«åº“ï¼ˆé¦–é¡µï¼‰ â†’ index.html
â”œâ”€â”€ user/       # ä¸ªäººåº“ â†’ user.html
â””â”€â”€ admin/      # ç®¡ç†åå° â†’ admin.html
```

æ¯ä¸ªåº”ç”¨æœ‰ç‹¬ç«‹çš„å…¥å£æ–‡ä»¶å’Œé¡µé¢ç»„ä»¶ï¼Œå…±äº«é€šç”¨ç»„ä»¶å’Œ Hooksã€‚

### 2. å…¥å£æ–‡ä»¶è§„èŒƒ

æ¯ä¸ªåº”ç”¨çš„å…¥å£æ–‡ä»¶ï¼ˆå¦‚ `shared/App.tsx`ï¼‰åªå…è®¸åŒ…å«ï¼š
- âœ… å…¨å±€ `Provider`
- âœ… è·¯ç”±/è§†å›¾åˆ‡æ¢
- âœ… åº”ç”¨åˆå§‹åŒ–

**ç»å¯¹ç¦æ­¢**å†™å…¥ï¼š
- âŒ ä¸šåŠ¡é€»è¾‘
- âŒ UI ç»„ä»¶
- âŒ Supabase æŸ¥è¯¢
- âŒ å¤æ‚çŠ¶æ€ç®¡ç†

::: danger è¿è§„å¤„ç†
å¦‚æœä¸å°å¿ƒå†™å…¥å…¥å£æ–‡ä»¶ï¼Œå¿…é¡»ç«‹å³é‡æ„ï¼Œå°†å†…å®¹æ‹†åˆ†åˆ°å¯¹åº”æ¨¡å—ã€‚
:::

### 3. æ–°åŠŸèƒ½å¿…é¡»è‡ªåŠ¨æ¨¡å—åŒ–

ç”¨æˆ·æå‡ºæ–°åŠŸèƒ½æ—¶ï¼Œå¿…é¡»è‡ªåŠ¨æ‹†åˆ†ä¸ºæ¨¡å—ï¼Œå¹¶åˆ›å»ºå¯¹åº”æ–‡ä»¶ã€‚

#### æ–‡ä»¶ç»„ç»‡è§„èŒƒ

```
src/
â”œâ”€â”€ apps/                # MPA åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ shared/          # å…±äº«åº“åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ SharedMainView.tsx
â”‚   â”œâ”€â”€ user/            # ä¸ªäººåº“åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ UserMainView.tsx
â”‚   â””â”€â”€ admin/           # ç®¡ç†åå°
â”‚       â”œâ”€â”€ AdminLayout.tsx
â”‚       â””â”€â”€ pages/       # åå°é¡µé¢
â”‚
â”œâ”€â”€ features/            # åŠŸèƒ½æ¨¡å—
â”‚   â””â”€â”€ lineups/         # ç‚¹ä½ç®¡ç†æ ¸å¿ƒåŠŸèƒ½
â”‚
â”œâ”€â”€ components/          # é€šç”¨ç»„ä»¶ï¼ˆè·¨åº”ç”¨å…±äº«ï¼‰
â”‚   â””â”€â”€ <ComponentName>.tsx
â”‚
â”œâ”€â”€ hooks/               # è‡ªå®šä¹‰ Hooks
â”‚   â””â”€â”€ use<Name>.ts
â”‚
â”œâ”€â”€ lib/                 # åº“å°è£…
â”‚   â””â”€â”€ <name>.ts
â”‚
â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â””â”€â”€ <name>Service.ts
â”‚
â”œâ”€â”€ types/               # TypeScript ç±»å‹
â”‚   â””â”€â”€ <name>.ts
â”‚
â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
    â””â”€â”€ <name>.ts
```

::: tip åŸåˆ™
ä¼˜å…ˆ **åˆ›å»ºæ–°æ–‡ä»¶**ï¼Œè€Œä¸æ˜¯ç»§ç»­æ‰©å±•æ—§æ–‡ä»¶ã€‚
:::

### 4. React + TypeScript å¼ºåˆ¶è§„èŒƒ

#### ç»„ä»¶è§„èŒƒ

- âœ… ä¸€å¾‹ä½¿ç”¨å‡½æ•°ç»„ä»¶ä¸ `Hooks`
- âœ… æ‰€æœ‰ `props` ã€ `state` ã€è¿”å›å€¼å¿…é¡»æœ‰æ˜ç¡® `TS` ç±»å‹
- âŒ ç¦æ­¢ `any`ï¼ˆé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚ï¼Œå¹¶æ ‡æ³¨ `TODO` ï¼‰

```tsx
// âœ… æ­£ç¡®ç¤ºä¾‹
interface ButtonProps {
  text: string;
  onClick: () => void;
  disabled?: boolean;
}

const Button: React.FC<ButtonProps> = ({ text, onClick, disabled = false }) => {
  return (
    <button onClick={onClick} disabled={disabled}>
      {text}
    </button>
  );
};

// âŒ é”™è¯¯ç¤ºä¾‹
const Button = (props: any) => {  // ç¦æ­¢ä½¿ç”¨ any
  return <button>{props.text}</button>;
};
```

#### åˆ†å±‚è§„èŒƒ

- **UI å±‚ä¸é€»è¾‘å±‚å¿…é¡»åˆ†ç¦»**
- **å±•ç¤ºç»„ä»¶ï¼ˆUIï¼‰ä¸å¾—åŒ…å«ä¸šåŠ¡é€»è¾‘**
- **ä¸šåŠ¡é€»è¾‘å¿…é¡»æ”¾åœ¨ hooks ä¸­ï¼ˆuseXxxï¼‰**
- **é¿å…åœ¨ç»„ä»¶ä¸­å†™å¤æ‚é€»è¾‘ï¼Œå¿…é¡»æŠ½ç¦»**

```tsx
// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šé€»è¾‘åˆ†ç¦»
// hooks/useLineups.ts
export function useLineups() {
  const [lineups, setLineups] = useState<Lineup[]>([]);
  const [loading, setLoading] = useState(false);
  
  const fetchLineups = async () => {
    setLoading(true);
    const data = await supabase.from('valorant_lineups').select('*');
    setLineups(data);
    setLoading(false);
  };
  
  return { lineups, loading, fetchLineups };
}

// components/LineupList.tsx
const LineupList: React.FC = () => {
  const { lineups, loading, fetchLineups } = useLineups();
  
  useEffect(() => {
    fetchLineups();
  }, []);
  
  if (loading) return <div>Loading...</div>;
  
  return (
    <div>
      {lineups.map(lineup => (
        <LineupCard key={lineup.id} lineup={lineup} />
      ))}
    </div>
  );
};

// âŒ é”™è¯¯ç¤ºä¾‹ï¼šé€»è¾‘æ··åœ¨ç»„ä»¶ä¸­
const LineupList: React.FC = () => {
  const [lineups, setLineups] = useState([]);
  
  useEffect(() => {
    // âŒ ä¸è¦åœ¨ç»„ä»¶ä¸­ç›´æ¥å†™ä¸šåŠ¡é€»è¾‘
    supabase.from('valorant_lineups').select('*').then(data => {
      setLineups(data);
    });
  }, []);
  
  return <div>...</div>;
};
```

### 5. Supabase ä½¿ç”¨è§„èŒƒ

#### ç±»å‹å£°æ˜

è¡¨æ•°æ®ç±»å‹å¿…é¡»ç”¨ `TypeScript` ç±»å‹å£°æ˜ï¼š

```typescript
// types/database.ts
export interface Lineup {
  id: string;
  user_id: string;
  title: string;
  map_name: string;
  agent_name: string;
  side: 'attack' | 'defense';
  stand_img?: string;
  aim_img?: string;
  land_img?: string;
  source_link?: string;
  author_name?: string;
  author_avatar?: string;
  author_uid?: string;
  created_at: string;
  updated_at: string;
}
```

#### çŠ¶æ€ç®¡ç†

æ‰€æœ‰è¯·æ±‚å¿…é¡»è€ƒè™‘ 3 ç§çŠ¶æ€ï¼š

```typescript
interface DataState<T> {
  data: T | null;
  loading: boolean;
  error: Error | null;
}

// âœ… æ­£ç¡®ç¤ºä¾‹
export function useLineups() {
  const [state, setState] = useState<DataState<Lineup[]>>({
    data: null,
    loading: false,
    error: null
  });
  
  const fetchLineups = async () => {
    setState(prev => ({ ...prev, loading: true, error: null }));
    
    try {
      const { data, error } = await supabase
        .from('valorant_lineups')
        .select('*');
      
      if (error) throw error;
      
      setState({ data, loading: false, error: null });
    } catch (error) {
      setState({ data: null, loading: false, error: error as Error });
    }
  };
  
  return { ...state, fetchLineups };
}
```

#### Storage è®¿é—®

è®¿é—® `Storage` æ—¶å¿…é¡»è¯´æ˜ `public/private` ç­–ç•¥ï¼š

```typescript
// âœ… æ­£ç¡®ç¤ºä¾‹
// ä¸Šä¼ åˆ° public bucket
const { data, error } = await supabase.storage
  .from('public-images')  // public bucket
  .upload(`lineups/${filename}`, file);

// è·å– public URL
const { data: { publicUrl } } = supabase.storage
  .from('public-images')
  .getPublicUrl(`lineups/${filename}`);
```

#### RLS æƒé™

å¿…é¡»è€ƒè™‘ `RLS` æƒé™å¯¹å‰ç«¯çš„å½±å“ï¼š

```typescript
// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šæ£€æŸ¥ç”¨æˆ·æƒé™
const canEdit = lineup.user_id === currentUser?.id;

if (canEdit) {
  // æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®
}

// âŒ é”™è¯¯ç¤ºä¾‹ï¼šä¸æ£€æŸ¥æƒé™ç›´æ¥æ“ä½œ
await supabase
  .from('valorant_lineups')
  .delete()
  .eq('id', lineup.id);  // å¯èƒ½å›  RLS å¤±è´¥
```

## ğŸ“ ä»£ç é£æ ¼

### å‘½åè§„èŒƒ

#### ç»„ä»¶å‘½å

```typescript
// âœ… PascalCase
const LineupCard: React.FC = () => { };
const EditorModal: React.FC = () => { };

// âŒ é”™è¯¯
const lineupCard = () => { };
const editor_modal = () => { };
```

#### Hooks å‘½å

```typescript
// âœ… use + PascalCase
const useLineups = () => { };
const useValorantData = () => { };

// âŒ é”™è¯¯
const getLineups = () => { };
const valorantData = () => { };
```

#### å˜é‡å‘½å

```typescript
// âœ… camelCase
const lineupData = [];
const isLoading = false;

// âŒ é”™è¯¯
const LineupData = [];
const is_loading = false;
```

#### å¸¸é‡å‘½å

```typescript
// âœ… UPPER_SNAKE_CASE
const API_BASE_URL = 'https://api.example.com';
const MAX_FILE_SIZE = 5 * 1024 * 1024;

// âŒ é”™è¯¯
const apiBaseUrl = 'https://api.example.com';
```

### æ–‡ä»¶å‘½å

```
âœ… æ­£ç¡®ï¼š
- LineupCard.tsx
- useLineups.ts
- authorFetcher.ts
- maps.ts

âŒ é”™è¯¯ï¼š
- lineup-card.tsx
- use_lineups.ts
- AuthorFetcher.ts
```

### å¯¼å…¥é¡ºåº

```typescript
// 1. React ç›¸å…³
import React, { useState, useEffect } from 'react';

// 2. ç¬¬ä¸‰æ–¹åº“
import { supabase } from '@supabase/supabase-js';
import Icon from 'lucide-react';

// 3. æœ¬åœ°ç»„ä»¶
import LineupCard from './LineupCard';
import EditorModal from './EditorModal';

// 4. Hooks
import { useLineups } from '../hooks/useLineups';
import { useValorantData } from '../hooks/useValorantData';

// 5. å·¥å…·å‡½æ•°
import { fetchAuthorInfo } from '../utils/authorFetcher';

// 6. ç±»å‹
import type { Lineup } from '../types/database';

// 7. æ ·å¼
import './styles.css';
```

## é”™è¯¯å¤„ç†

### Try-Catch è§„èŒƒ

```typescript
// âœ… æ­£ç¡®ç¤ºä¾‹
try {
  const result = await fetchData();
  return result;
} catch (error) {
  console.error('è·å–æ•°æ®å¤±è´¥:', error);
  // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
  setAlertMessage('è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  return null;
}

// âŒ é”™è¯¯ç¤ºä¾‹
try {
  const result = await fetchData();
  return result;
} catch (error) {
  // ä¸å¤„ç†é”™è¯¯
}
```

### è¾¹ç•Œæƒ…å†µå¤„ç†

```typescript
// âœ… æ­£ç¡®ç¤ºä¾‹
function processLineup(lineup: Lineup | null) {
  if (!lineup) {
    console.warn('ç‚¹ä½æ•°æ®ä¸ºç©º');
    return null;
  }
  
  if (!lineup.title) {
    console.warn('ç‚¹ä½æ ‡é¢˜ç¼ºå¤±');
    return null;
  }
  
  // å¤„ç†é€»è¾‘
  return processedData;
}

// âŒ é”™è¯¯ç¤ºä¾‹
function processLineup(lineup: Lineup) {
  // ä¸æ£€æŸ¥ null æˆ–å¿…éœ€å­—æ®µ
  return lineup.title.toUpperCase();  // å¯èƒ½æŠ¥é”™
}
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### useMemo å’Œ useCallback

```typescript
// âœ… æ­£ç¡®ä½¿ç”¨
const filteredLineups = useMemo(() => {
  return lineups.filter(lineup => 
    lineup.map_name === selectedMap
  );
}, [lineups, selectedMap]);

const handleClick = useCallback(() => {
  console.log('Clicked');
}, []);

// âŒ è¿‡åº¦ä½¿ç”¨
const name = useMemo(() => 'John', []);  // ä¸éœ€è¦ memo
```

### é¿å…ä¸å¿…è¦çš„æ¸²æŸ“

```typescript
// âœ… ä½¿ç”¨ React.memo
const LineupCard = React.memo<LineupCardProps>(({ lineup }) => {
  return <div>{lineup.title}</div>;
});

// âœ… æ‹†åˆ†ç»„ä»¶
const LineupList = () => {
  const [selectedId, setSelectedId] = useState<string | null>(null);
  
  return (
    <div>
      {lineups.map(lineup => (
        <LineupCard 
          key={lineup.id}
          lineup={lineup}
          isSelected={lineup.id === selectedId}
          onSelect={setSelectedId}
        />
      ))}
    </div>
  );
};
```

## ğŸ“ æ³¨é‡Šè§„èŒƒ

### å‡½æ•°æ³¨é‡Š

```typescript
/**
 * è·å–ç‚¹ä½åˆ—è¡¨
 * @param userId - ç”¨æˆ· ID
 * @param mapName - åœ°å›¾åç§°ï¼ˆå¯é€‰ï¼‰
 * @returns ç‚¹ä½æ•°ç»„
 */
async function fetchLineups(
  userId: string, 
  mapName?: string
): Promise<Lineup[]> {
  // å®ç°
}
```

### å¤æ‚é€»è¾‘æ³¨é‡Š

```typescript
// âœ… è§£é‡Šä¸ºä»€ä¹ˆè¿™ä¹ˆåš
// ä½¿ç”¨ 1 ç§’é˜²æŠ–é¿å…é¢‘ç¹è°ƒç”¨ API
const debouncedFetch = debounce(fetchAuthorInfo, 1000);

// âŒ æ³¨é‡Šæ˜¾è€Œæ˜“è§çš„å†…å®¹
// è®¾ç½® loading ä¸º true
setLoading(true);
```

### TODO æ³¨é‡Š

```typescript
// TODO: æ·»åŠ é”™è¯¯é‡è¯•æœºåˆ¶
// TODO: ä¼˜åŒ–å›¾ç‰‡åŠ è½½æ€§èƒ½
// FIXME: ä¿®å¤åœ¨ Safari ä¸­çš„æ˜¾ç¤ºé—®é¢˜
```

## ğŸ“ Git æäº¤è§„èŒƒ

### Commit Message æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type ç±»å‹

- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

### ç¤ºä¾‹

```bash
# æ–°åŠŸèƒ½
git commit -m "feat(author): æ·»åŠ ä½œè€…ä¿¡æ¯è‡ªåŠ¨è·å–åŠŸèƒ½"

# Bug ä¿®å¤
git commit -m "fix(image): ä¿®å¤å›¾ç‰‡é˜²ç›—é“¾é—®é¢˜"

# æ–‡æ¡£
git commit -m "docs(readme): æ›´æ–°å®‰è£…è¯´æ˜"

# é‡æ„
git commit -m "refactor(hooks): é‡æ„ useLineups hook"
```

## ä»£ç å®¡æŸ¥æ¸…å•

æäº¤ PR å‰æ£€æŸ¥ï¼š

- [ ] ä»£ç ç¬¦åˆ TypeScript è§„èŒƒ
- [ ] æ²¡æœ‰ `any` ç±»å‹ï¼ˆé™¤éå¿…è¦ï¼‰
- [ ] UI ä¸é€»è¾‘åˆ†ç¦»
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- [ ] æ²¡æœ‰ console.logï¼ˆé™¤éå¿…è¦ï¼‰
- [ ] æµ‹è¯•é€šè¿‡
- [ ] ç¬¦åˆå‘½åè§„èŒƒ
- [ ] æ²¡æœ‰å‘ App.tsx å†™å…¥ä¸šåŠ¡ä»£ç 

## è‡ªåŠ¨çº é”™æœºåˆ¶

å¦‚æœè¿åä»¥ä¸Šä»»ä¸€è§„åˆ™ï¼š
- å†™è¿› App.tsx
- æœªæ¨¡å—åŒ–æ‹†åˆ†
- ä½¿ç”¨ any
- å°† UI + é€»è¾‘æ··åœ¨ä¸€èµ·
- Supabase ä½¿ç”¨ä¸è§„èŒƒ

å¿…é¡»ç«‹å³è‡ªåŠ¨é‡æ„ï¼Œä½¿ä»£ç ç¬¦åˆè§„èŒƒã€‚

## ä¿¡æ¯ä¸è¶³æ—¶çš„è¡Œä¸º

å¦‚æœéœ€æ±‚ä¸å¤Ÿå®Œæ•´ï¼š

1. **æç¤ºéœ€è¦è¿›ä¸€æ­¥ä¿¡æ¯**
2. **æˆ–åœ¨æœ€ä½³å®è·µèŒƒå›´å†…åˆç†å‡è®¾ï¼Œå¹¶æ ‡æ³¨ï¼š**
   ```typescript
   // å‡è®¾ï¼šç”¨æˆ·éœ€è¦æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—
   const sortedLineups = lineups.sort((a, b) => 
     new Date(b.created_at).getTime() - new Date(a.created_at).getTime()
   );
   ```

## æ€»ç»“

éµå®ˆä»¥ä¸Šè§„èŒƒå¯ä»¥ç¡®ä¿ï¼š
- âœ… ä»£ç è´¨é‡é«˜
- âœ… æ˜“äºç»´æŠ¤
- âœ… å›¢é˜Ÿåä½œé¡ºç•…
- âœ… å‡å°‘ Bug
- âœ… æé«˜å¼€å‘æ•ˆç‡
