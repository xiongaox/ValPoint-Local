# 作者信息自动获取

`ValPoint` 支持从 B 站和抖音视频链接自动获取作者信息，包括头像、昵称和主页链接。

## 🌐 支持的平台

### B 站（bilibili）

支持以下链接格式：

```
# 视频链接
https://www.bilibili.com/video/BV19rmoBqEdK/

# 短链接
https://b23.tv/abc123

# 个人主页
https://space.bilibili.com/1845224

# 分享文案
【深夜2万人观看！】 https://www.bilibili.com/video/BV19rmoBqEdK/
```

### 抖音（douyin）

支持以下链接格式：

```
# 短链接
https://v.douyin.com/1giSwq_zDSI/

# 长链接
https://www.douyin.com/video/7123456789

# 分享文案
5.89 G@v.FH 02/24 DHV:/ 编译与解释代码如何共处同一程序中? 
https://v.douyin.com/1giSwq_zDSI/ 复制此链接，打开Dou音搜索，直接观看视频！
```

## 📝 使用方式

### 方式 1：自动获取（推荐）

1. 在编辑器中输入视频链接
2. 等待 **1 秒**，系统自动获取作者信息
3. 成功后显示作者头像和昵称

::: tip 防抖机制
系统使用 **1 秒** 防抖，避免频繁调用 `API` 。输入链接后稍等片刻即可。
:::

### 方式 2：剪贴板填入

1. 复制包含视频链接的分享文案
2. 点击 `剪贴板填入` 按钮
3. 系统自动提取链接并获取作者信息

::: details 链接提取优先级
系统会优先提取以下平台的链接：
1. bilibili.com
2. douyin.com
3. tiktok.com
4. 其他链接
:::

### 方式 3：手动刷新

适用场景：
- 修改了视频链接
- 自动获取失败
- 想要强制更新作者信息

操作步骤：
1. 确保已输入视频链接
2. 点击右上角 `手动刷新` 按钮
3. 系统强制重新获取作者信息

## 📺 显示效果

### 获取中

显示蓝色提示框：

```
🔄 正在获取作者信息...
```

### 获取成功

显示绿色提示框，包含：
- 作者头像（圆形）
- 作者昵称
- ✓ 勾选图标

### 获取失败

静默失败，不影响点位保存。可以：
- 检查链接格式
- 点击 `手动刷新` 重试
- 手动填写作者信息

## ✍️ 点位详情中的作者信息

### 可点击跳转

当有作者 ID 时，点击作者信息可跳转到：
- B 站：`https://space.bilibili.com/{mid}`
- 抖音：`https://www.douyin.com/user/{sec_uid}`

## 🏗️ 技术实现

### 后端服务

使用 Supabase Edge Function `get-video-author`：
- 绕过浏览器 `CORS` 限制
- 服务端请求 B 站和抖音 `API`
- 解析 HTML 提取作者信息

### 防盗链处理

B 站和抖音的图片有防盗链保护，所有头像必须添加：

```tsx
<img 
  src={authorInfo.avatar} 
  referrerPolicy="no-referrer"  // 🔥 必须添加
  alt={authorInfo.name}
/>
```

::: warning 重要
如果头像显示不出来（ `403` 错误），检查是否添加了 `referrerPolicy="no-referrer"` 属性。
:::

### 数据存储

作者信息存储在数据库中：

| 字段 | 说明 | 示例 |
|------|------|------|
| `author_name` | 作者昵称 | "蘅鲼" |
| `author_avatar` | 头像 URL | "https://i2.hdslb.com/..." |
| `author_uid` | 用户 ID | "1845224" (B站) 或 "MS4wLjABAAAA..." (抖音) |

## ❓ 常见问题

### Q: 为什么获取失败？

可能的原因：
1. 链接格式不正确
2. 视频已被删除或设为私密
3. 网络问题
4. `Edge Function` 服务异常
5. 挂了代理

**解决方案**：
- 检查链接是否完整
- 尝试手动刷新
- 查看浏览器控制台错误信息
- 关闭代理

### Q: 头像显示不出来？

**原因**：防盗链保护

**解决方案**：确保 `<img>` 标签添加了 `referrerPolicy="no-referrer"`

### Q: 可以手动修改作者信息吗？

目前不支持手动修改。如果自动获取的信息不正确，可以：
1. 检查视频链接是否正确
2. 尝试使用视频作者的个人主页链接

### Q: 作者信息会自动更新吗？

不会。作者信息在首次获取后保存到数据库，不会自动更新。如需更新：
1. 点击 `手动刷新` 按钮
2. 或重新输入链接

### Q: 支持其他平台吗？

目前仅支持 B 站和抖音。如需支持其他平台，请提交 `Issue` 。
