# 部署指南

**ValPoint** 可以部署到多个平台，推荐使用 `Vercel` 或 `Cloudflare Pages` 。

| 平台 | 是否真·一键 | README 按钮 | 自动 Fork | 环境变量引导
| :--- | :--- | :--- | :--- | :--- |
| Vercel | ⭐⭐⭐⭐⭐ | ✅ 官方 | ✅ | ✅ 强制填写
| Cloudflare Pages | ⭐⭐⭐ | ⚠️ 半官方 | ❌ | ⚠️ 手动
| Zeabur | ⭐⭐⭐⭐ | ⚠️ 非官方 | ✅ | ⚠️ 部分

::: info 一句话结论

👉 对外开源首选：Vercel

👉 国内/边缘/CDN：Cloudflare Pages

👉 全栈 / 后端 / DB：Zeabur

:::

## 🚀 Vercel 部署（推荐）

### 优势
- ✅ 自动构建和部署
- ✅ 全球 CDN 加速
- ✅ 免费 SSL 证书
- ✅ 自动预览部署
- ✅ 环境变量管理

### 部署步骤

#### 1. 一键部署

点击下面按钮一键部署

[![Deploy with Vercel](https://vercel.com/button)](
https://vercel.com/new/clone?repository-url=https://github.com/xiongaox/ValPoint&project-name=valpoint&repository-name=valpoint&env=VITE_SUPABASE_SHARE_ANON_KEY,VITE_SUPABASE_ANON_KEY,VITE_SUPABASE_URL,VITE_SUPABASE_SHARE_URL
)

#### 2. Fork 项目

将项目 `Fork` 到你的 `GitHub` 账号。

#### 2. 导入到 Vercel

1. 访问 [vercel.com](https://vercel.com)
2. 点击 `New Project`
3. 选择你的 `GitHub` 仓库
4. 点击 `Import`

#### 3. 配置项目

`Vercel` 会自动检测 `Vite` 项目，无需手动配置构建命令。

默认配置：
```
Build Command: npm run build
Output Directory: dist
Install Command: npm install
```

#### 4. 添加环境变量

在 `Vercel` 项目设置中添加环境变量：

```env
VITE_SUPABASE_URL=https://[PROJECT_ID].supabase.co
VITE_SUPABASE_ANON_KEY=[YOUR_ANON_KEY]
VITE_SUPABASE_SHARE_URL=https://[SHARE_PROJECT_ID].supabase.co
VITE_SUPABASE_SHARE_ANON_KEY=[YOUR_SHARE_ANON_KEY]
```

#### 5. 部署

点击 `Deploy` 按钮，等待构建完成。

#### 6. 配置自定义域名（可选）

1. 在 `Vercel` 项目设置中点击 `Domains`
2. 添加你的域名
3. 按照提示配置 `DNS` 记录

### 自动部署

配置完成后，每次推送到 `GitHub` 都会自动触发部署：
- `main` 分支 → 生产环境
- 其他分支 → 预览环境

## 🚀 Cloudflare Pages 部署

### 优势
- ✅ 全球 `CDN` 网络
- ✅ 无限带宽
- ✅ 免费 `SSL` 证书
- ✅ 快速构建

### 部署步骤

#### 1. 一键部署

点击下面按钮一键部署

[![Deploy to Cloudflare Pages](https://deploy.workers.cloudflare.com/button)](
https://dash.cloudflare.com/?to=/:account/pages/new
)

#### 2. 连接 GitHub

1. 访问 [Cloudflare Pages](https://pages.cloudflare.com)
2. 点击 `Create a project`
3. 连接你的 `GitHub` 账号
4. 选择 `ValPoint` 仓库

#### 2. 配置构建设置

```
Build command: npm run build
Build output directory: dist
Root directory: /
```

#### 3. 添加环境变量

在项目设置中添加环境变量（同 `Vercel` ）。

#### 4. 部署

点击 `Save and Deploy` ，等待构建完成。

## 🚀 Zeabur 部署

### 优势
- ✅ 国内访问速度快
- ✅ 支持全栈部署
- ✅ 自动识别项目类型
- ✅ 免费额度充足

### 部署步骤

#### 1. 一键部署

点击下面按钮部署

[![Deploy on Zeabur](https://zeabur.com/button.svg)](
https://zeabur.com/templates/github?repo=xiongaox/ValPoint
)

#### 2. 手动部署

##### 1. 注册并登录 Zeabur
- 访问 [zeabur.com](https://zeabur.com)
- 使用 GitHub 账号登录

##### 2. 创建新项目
- 在控制台点击 `Create Project`
- 选择区域

##### 3. 创建服务
- 点击 `Create Service`
- 选择 `Git`
- 搜索并选择你的 `ValPoint` 仓库

##### 4. 配置环境变量
- 在服务设置中找到 `Variables`
- 添加项目所需的 `Supabase` 环境变量

##### 5. 等待部署
- Zeabur 会自动识别项目类型并开始构建

## 🚀 自托管部署

### 使用 Nginx

#### 1. 构建项目

```bash
npm run build
```

#### 2. 配置 Nginx

```nginx
server {
    listen 80;
    server_name valpoint.example.com;
    
    root /var/www/valpoint/dist;
    index index.html;
    
    # SPA 路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # Gzip 压缩
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
```

#### 3. 部署文件

```bash
# 上传构建产物
scp -r dist/* user@server:/var/www/valpoint/dist/

# 重启 Nginx
ssh user@server "sudo systemctl restart nginx"
```

## ⚙️ 环境变量管理

### 开发环境

使用 `.env` 文件：

```env
VITE_SUPABASE_URL=https://[PROJECT_ID].supabase.co
VITE_SUPABASE_ANON_KEY=[YOUR_ANON_KEY]
```

### 生产环境

在部署平台的环境变量设置中配置：

| 平台 | 配置位置 |
|------|----------|
| Vercel | Settings → Environment Variables |
| Cloudflare Pages | Settings → Environment variables |
| 自托管 | `.env.production` 或系统环境变量 |

::: warning 安全提示
- 不要将 `.env` 文件提交到 Git
- 使用不同的密钥用于开发和生产环境
- 定期更换密钥
:::

## ⚡ 性能优化

### 构建优化

#### 1. 代码分割

Vite 自动进行代码分割，无需额外配置。

#### 2. 压缩

生产构建自动启用压缩：
- `JavaScript` 压缩（Terser）
- `CSS` 压缩（cssnano）

#### 3. Tree Shaking

自动移除未使用的代码。

### CDN 配置

#### 使用 Vercel CDN

Vercel 自动提供全球 `CDN` ，无需配置。

#### 使用 Cloudflare CDN

`Cloudflare Pages` 自动使用 `Cloudflare CDN` 。

#### 自定义 CDN

如果自托管，可以配置 `CDN` ：

```nginx
# 设置缓存头
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    add_header X-Content-Type-Options "nosniff";
}
```

## 📈 监控和日志

### Vercel Analytics

启用 `Vercel Analytics` ：
1. 在项目设置中启用 `Analytics`
2. 查看访问统计和性能指标

### 自定义监控

可以集成第三方监控服务：
- Google Analytics
- Sentry（错误监控）
- LogRocket（用户行为）

## ❓ 常见问题

### Q: 部署后页面空白？

检查：
1. 环境变量是否配置正确
2. 构建是否成功
3. 浏览器控制台是否有错误

### Q: 路由 404 错误？

需要配置 `SPA` 路由重写：
- Vercel：自动配置
- Cloudflare Pages：自动配置
- Nginx：添加 `try_files` 配置

### Q: 环境变量不生效？

确保：
1. 变量名以 `VITE_` 开头
2. 重新构建项目
3. 清除浏览器缓存

### Q: 构建失败？

检查：
1. `Node.js` 版本（需要 >= 18）
2. 依赖是否安装完整
3. 构建日志中的错误信息

### Q: 如何回滚部署？

- Vercel：在 `Deployments` 页面选择之前的部署，点击 `Promote to Production`
- Cloudflare Pages：在 `Deployments` 页面选择之前的部署，点击 `Rollback`
- 自托管：恢复之前的构建产物
