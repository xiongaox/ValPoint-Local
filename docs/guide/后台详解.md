# 后台详解

管理后台是 ValPoint 的运营管理中心，提供用户管理、投稿审核、点位管理、数据统计等功能。本页将详细介绍后台的各项功能。

![横幅](https://placehold.jp/800x200.png?text=后台首页)

> [!WARNING]
> 管理后台需要管理员权限才能访问。

## 访问方式

| 环境 | 地址 |
|------|------|
| 本地开发 | `http://localhost:3208/admin.html` |
| Docker 部署 | `http://localhost:8080/admin.html` |
| 线上环境 | `https://yourdomain.com/admin.html` |

---

## 登录认证

### 环境变量认证（推荐）

在 `.env` 中配置管理员账号：

```env
VITE_ADMIN_ACCOUNT=admin@example.com
VITE_ADMIN_PASSWORD=your_secure_password
```

使用该账号密码登录管理后台，系统会自动识别为管理员身份。

### Supabase 用户认证

也可以使用普通用户账号登录后台，但需要在数据库中授予管理员权限：

1. 在 Supabase Auth 中创建用户
2. 在 `user_profiles` 表中设置 `role = 'admin'` 或 `role = 'super_admin'`

---

## 仪表盘

仪表盘是管理后台的首页，展示核心运营数据概览。

### 统计卡片

顶部展示四个统计卡片：

| 卡片 | 说明 |
|------|------|
| 总用户数 | 平台注册用户总数 |
| 总点位数 | 共享库中的点位总数 |
| 待审核 | 等待审核的投稿数量 |
| 今日活跃 | 今日登录的用户数 |

### 最近活动

展示平台最近的动态记录：

- 用户注册
- 点位投稿
- 审核操作
- 用户登录

### 数据图表

可视化展示平台数据趋势：

- 用户增长趋势
- 点位增长趋势
- 各地图点位分布
- 各英雄点位分布

---

## 用户管理

管理平台所有注册用户。

### 用户列表

以表格形式展示用户信息：

| 字段 | 说明 |
|------|------|
| 头像 | 用户选择的卡面头像 |
| 昵称 | 用户设置的昵称 |
| 邮箱 | 注册邮箱 |
| 角色 | 普通用户/管理员/超级管理员 |
| 点位数 | 该用户的个人点位数量 |
| 注册时间 | 账号创建时间 |

### 搜索与筛选

- 搜索框：支持按邮箱或昵称搜索
- 角色筛选：筛选特定角色的用户

### 用户操作

点击用户行可进行以下操作：

- **查看详情**：查看用户完整信息
- **编辑信息**：修改用户昵称、角色等
- **权限管理**：授予或撤销管理员权限
- **批量下载权限**：授予用户批量下载功能

---

## 投稿审核

审核用户提交到共享库的点位。

![横幅](https://placehold.jp/800x200.png?text=投稿审核页)

### 待审核列表

展示所有等待审核的投稿：

- 投稿时间
- 投稿用户
- 点位标题
- 地图/英雄信息

### 审核操作

点击投稿条目，打开审核弹窗：

1. **预览点位**：查看点位详情和图片
2. **通过**：将点位发布到共享库
3. **拒绝**：拒绝投稿，可填写拒绝原因

### 审核历史

查看已审核的投稿记录：

- 审核时间
- 审核结果（通过/拒绝）
- 审核人
- 拒绝原因（如有）

---

## 共享库管理

管理公共共享库中的所有点位。

### 点位列表

以卡片或表格形式展示共享点位：

- 点位标题
- 地图/英雄
- 投稿作者
- 创建时间
- 浏览次数

### 搜索与筛选

- 关键词搜索
- 地图筛选
- 英雄筛选
- 时间范围

### 点位操作

- **查看详情**：预览点位完整信息
- **编辑点位**：修改点位标题、描述等
- **删除点位**：从共享库中移除

> [!CAUTION]
> 删除操作不可恢复，请谨慎操作。

---

## 下载日志

查看用户的批量下载记录。

### 日志列表

| 字段 | 说明 |
|------|------|
| 下载时间 | 批量下载发起的时间 |
| 用户 | 发起下载的用户 |
| 下载范围 | 地图/英雄 |
| 点位数量 | 下载的点位总数 |

### 日志筛选

- 按用户筛选
- 按时间范围筛选
- 按地图筛选

---

## 系统设置

平台全局配置管理。

### 图床配置

| 设置项      | 说明                      |
| -------- | ----------------------- |
| 阿里云 OSS  | 配置 AccessKey、Bucket 等信息 |
| 腾讯云 COS  | 配置 SecretId、Bucket 等信息  |
| 七牛云 Kodo | 配置 AccessKey、Bucket 等信息 |

> [!NOTE]
> 管理员配置的图床将作为系统默认图床，用于存储共享库的点位图片。

### 功能开关

控制平台功能的启用状态：

- 用户注册开关
- 投稿功能开关
- 批量下载开关

### 数据维护

- **清理缓存**：清理系统缓存数据
- **数据导出**：导出平台数据备份
- **数据统计刷新**：重新计算统计数据

---

## 权限说明

### 角色类型

| 角色 | 权限范围 |
|------|------|
| `user` | 普通用户，无后台访问权限 |
| `admin` | 管理员，可访问后台大部分功能 |
| `super_admin` | 超级管理员，拥有全部权限 |

### 功能权限矩阵

| 功能 | 普通用户 | 管理员 | 超级管理员 |
|------|:------:|:------:|:------:|
| 访问后台 | ❌ | ✅ | ✅ |
| 查看仪表盘 | ❌ | ✅ | ✅ |
| 用户管理 | ❌ | ✅ | ✅ |
| 投稿审核 | ❌ | ✅ | ✅ |
| 共享库管理 | ❌ | ✅ | ✅ |
| 系统设置 | ❌ | ❌ | ✅ |
| 权限管理 | ❌ | ❌ | ✅ |

---

## 常见问题

### Q: 忘记管理员密码？

修改 `.env` 文件中的 `VITE_ADMIN_PASSWORD`，然后重启服务即可。

### Q: 如何添加多个管理员？

1. 在 Supabase Auth 中创建用户
2. 使用超级管理员账号登录后台
3. 在用户管理中将目标用户的角色设置为 `admin`

### Q: 管理后台打不开？

检查以下几点：

1. 确认访问路径正确（`/admin.html`）
2. 确认构建成功（`npm run build`）
3. 检查浏览器控制台错误信息
4. 确认 Supabase 连接正常

### Q: 审核通过的点位看不到？

1. 检查共享库 Supabase 连接配置
2. 确认审核操作成功完成
3. 刷新共享库页面
